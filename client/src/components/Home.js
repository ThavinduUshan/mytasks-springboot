import React, { useState, useEffect } from "react";
import axios from "axios";
import HeadBar from "./HeadBar";
import { Link } from "react-router-dom";

const Home = () => {
  const [tasks, setTasks] = useState([]);

  const getRemainigTime = (endDate, endTime) => {
    return new Promise((resolve, reject) => {
      if (!endDate || !endTime) {
        reject();
      } else {
        console.log(endDate, endTime);
        const end = new Date(endDate);
        const time = parseFloat(endTime);
        const endInmil = end.getTime() + time * 60 * 60 * 1000;
        const diff = endInmil - Date.now();
        console.log(end, time, endInmil, diff);
        const daysLeft = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hoursLeft = Math.floor(
          (diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );

        console.log(daysLeft, hoursLeft);
        const results = [daysLeft, hoursLeft];
        resolve(daysLeft);
      }
    });
  };

  useEffect(() => {
    axios.get("http://localhost:8080/").then((res) => {
      console.log(res);

      const resultArray = [];

      for (let i = 0; i < res.data.length; i++) {
        const end = new Date(res.data[i].endDate);
        const time = parseFloat(res.data[i].endTime);
        const endInmil = end.getTime() + time * 60 * 60 * 1000;
        const diff = endInmil - Date.now();
        console.log(end, time, endInmil, diff);
        const daysLeft = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hoursLeft = Math.floor(
          (diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );

        resultArray.push({
          id: res.data[i].id,
          tname: res.data[i].tname,
          tdescription: res.data[i].tdescription,
          endDate: res.data[i].endDate,
          endTime: res.data[i].endTime,
          daysLeft: daysLeft,
          hoursLeft: hoursLeft,
        });
      }

      setTasks(resultArray);
    });
  }, []);

  return (
    <>
      <HeadBar />
      <div className="flex justify-center  mb-10">
        <Link
          to="/new"
          className="px-5 py-4 text-xl rounded-lg  bg-blue-600 text-white hover:bg-blue-700 hover:shadow-md"
        >
          + Add New Task
        </Link>
      </div>
      {tasks && (
        <>
          {tasks.map((tk) => {
            return (
              <div
                key={tk?.id}
                className="mx-auto shadow-lg w-6/12 bg-gray-50 mb-10 px-16 py-10 rounded-lg"
              >
                <div className="flex justify-end ">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    className="w-6 h-6 mr-3"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"
                    />
                  </svg>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
                    />
                  </svg>
                </div>
                <h1 className="text-3xl font-medium mb-5 ">{tk?.tname}</h1>
                <p className="text-md mb-5">{tk?.tdescription}</p>
                <div className="flex mb-5">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6 mr-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"
                    />
                  </svg>
                  <p className="mr-5 font-medium ">{tk?.endDate}</p>
                </div>
                <div className="flex mb-5">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6 mr-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  <p className="mr-5 font-medium">Time Remaining :</p>
                  <p className="font-medium text-green-500">7 Days 4 Hours</p>
                </div>
                <div className="flex justify-end">
                  <button className="text-white text-lg rounded-lg px-5 py-3 bg-gray-800 hover:bg-white hover:text-gray-800 hover:border hover:border-gray-800 ">
                    Mark as Done
                  </button>
                </div>
              </div>
            );
          })}
        </>
      )}
    </>
  );
};

export default Home;
